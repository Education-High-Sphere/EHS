<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../css/boxicons.min.css" rel="stylesheet" />
    <link rel="icon" href="../src/logo.png" type="image/x-icon" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
    <link rel="stylesheet" href="../styles/register.css" />
    <title>EHS Cadastro</title>
  </head>
  <body>
    <div class="logo-img">
      <img src="../src/group.png" alt="logo" />
    </div>
    <div class="vertical-line"></div>

    <main class="container-register">
      <label class="label"><h1>Cadastro</h1></label>

      <form
        class="form-container"
        action="/users/register"
        method="POST"
      >
        <div class="input-box">
          <input name="name" placeholder="Nome" type="text" required />
        </div>

        <div class="input-box">
          <input
            name="email"
            placeholder="Endereço de e-mail"
            type="email"
            required
            pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
            oninvalid="setCustomValidity('Por favor, insira um endereço de e-mail válido.')"
            oninput="setCustomValidity('')"
          />
        </div>

        <div class="input-box">
          <input
            name="birth_date"
            placeholder="Data de nascimento"
            type="date"
            id="birthdate"
            required
          />
        </div>

        <div class="input-box">
          <select name="gender" id="" class="input-select">
            <option value="" disabled selected>Selecione o gênero</option>
            <option value="masculino">Masculino</option>
            <option value="feminino">Feminino</option>
            <option value="nao-binario">Não Binário</option>
            <option value="transgenero">Transgênero</option>
            <option value="outro">Outro</option>
          </select>
        </div>

        <div class="input-box">
          <input name="job" placeholder="Cargo" type="text" required />
        </div>

        <div class="input-box">
          <input
            name="phone"
            placeholder="Telefone"
            type="tel"
            oninput="if (this.value) this.value = this.value.replace(/^(\d{2})(\d)/g, '($1) $2').replace(/(\d{5})(\d)/g, '$1-$2').replace(/(-\d{4})\d+?$/, '$1')"
            required
          />
        </div>

        <div class="input-box">
          <input
            id="senha"
            name="password"
            placeholder="Senha"
            type="password"
            required
          />
          <a href="#" onclick="togglePassword()"
            ><i class="bx bx-hide" id="togglePassword"></i
          ></a>
        </div>

        <div class="input-box">
          <input
            name="confirmar_senha"
            id="confirmar_senha"
            placeholder="Confirme sua senha"
            type="password"
            required
          />
          <a href="#" onclick="toggleConfirmPassword()"
            ><i class="bx bx-hide" id="toggleConfirmPassword"></i
          ></a>
        </div>

        <p class="switch-form">
          Já possui uma conta? <a href="#" onclick="showLogin()">Login</a>
        </p>

        <div
          id="g_id_onload"
          data-client_id="YOUR_CLIENT_ID"
          data-callback="handleCredentialResponse"
        ></div>
        <div class="g_id_signin" data-type="standard"></div>

        <div class="termos-aceite">
          <label class="custom-checkbox">
            <input name="termos_aceitos" type="checkbox" value="sim" required />
            <span class="checkmark"></span>
            Li e aceito os
            <a href="#"
              >Termos de uso do EHS, Aviso de privacidade, Termos LGPD.</a
            >
          </label>
        </div>

        <button type="submit">Cadastre-se</button>
      </form>
    </main>

    <main class="container-login" style="display: none">
      <label class="label"><h1>Login</h1></label>

      <form
        class="form-container"
        action="/users/login"
        method="POST"
      >
        <div class="input-box">
          <input name="email" placeholder="E-mail" type="email" required />
        </div>

        <div class="input-box">
          <input
            id="senha"
            name="password"
            placeholder="Senha"
            type="password"
            required
          />
          <a href="#" onclick="togglePassword()"
            ><i class="bx bx-hide" id="togglePassword"></i
          ></a>
        </div>

        <div class="remember-forgot">
          <label class="custom-checkbox">
            <input name="lembrar" type="checkbox" value="sim" />
            <span class="checkmark"></span>
            Lembrar de mim
          </label>
          <a href="#" style="color: #4a78a6; text-decoration: none"
            >Esqueceu a senha?</a
          >
        </div>

        <p class="switch-form">
          Não possui uma conta?
          <a href="#" onclick="showRegister()">Cadastre-se</a>
        </p>

        <div
          id="g_id_onload"
          data-client_id="YOUR_CLIENT_ID"
          data-callback="handleCredentialResponse"
        ></div>
        <div class="g_id_signin" data-type="standard"></div>

        <button type="submit">Entrar</button>
      </form>
    </main>

    <script>
      function showLogin() {
        document.querySelector(".container-register").style.display = "none";
        document.querySelector(".container-login").style.display = "block";
      }

      function showRegister() {
        document.querySelector(".container-login").style.display = "none";
        document.querySelector(".container-register").style.display = "block";
      }

      function verifyPassword() {
        var senha = document.getElementById("senha").value;
        var confirmar_senha = document.getElementById("confirmar_senha").value;

        if (senha !== confirmar_senha) {
          alert("As senhas não coincidem, por favor, tente novamente.");
          return false;
        }

        return true;
      }

      function togglePassword() {
        var passwordInput = document.getElementById("senha");
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          document.getElementById("togglePassword").style.color = "#4A78A6";
        } else {
          document.getElementById("senha").type = "password";
          document.getElementById("togglePassword").style.color = "gray";
        }
      }

      function toggleConfirmPassword() {
        var passwordInput = document.getElementById("confirmar_senha");
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          document.getElementById("toggleConfirmPassword").style.color =
            "#4A78A6";
        } else {
          passwordInput.type = "password";
          document.getElementById("toggleConfirmPassword").style.color = "gray";
        }
      }
      function handleCredentialResponse(response) {
    // Decodificar o token JWT
    const decodedToken = jwt_decode(response.credential);
    console.log("ID Token decodificado:", decodedToken);

    // Enviar para o backend
    fetch('/api/auth/googleAuth', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ idToken: response.credential })
    })
    .then(res => res.json())
    .then(data => {
        console.log("Resposta do backend:", data);
        // aqui você pode redirecionar ou salvar dados extras
    })
    .catch(err => console.error(err));
}
    </script>
  </body>
</html>
